# 模拟数据解决方案

## 问题描述

在微信开发者工具中运行时，出现以下错误：
```
Invalid spots data: <!DOCTYPE html>
```

**根本原因**：
1. 后端API服务（`http://localhost:8082`）未运行或无法访问
2. 微信开发者工具默认不允许访问 `localhost`（需要特殊配置）
3. API返回了HTML错误页面而不是JSON数据

## 解决方案

### 方案1: 使用模拟数据（已实现✅）

已在 `touristSpotService.js` 中添加了错误降级处理：
- 当API请求失败时，自动切换到模拟数据
- 包含10个武汉知名景点的完整数据
- 不影响正常的API调用流程

**优点**：
- 无需后端即可预览和开发
- 方便演示和测试UI功能
- 真实的武汉景点数据

**模拟数据包括**：
1. 黄鹤楼 (5A) - 114.305539, 30.544965
2. 东湖风景区 (5A) - 114.377827, 30.553673
3. 武汉大学 (4A) - 114.371785, 30.535812
4. 户部巷 (3A) - 114.295044, 30.547831
5. 武汉长江大桥 (4A) - 114.283211, 30.557536
6. 古琴台 (3A) - 114.266632, 30.549948
7. 木兰天池 (5A) - 114.596954, 31.046687
8. 归元禅寺 (4A) - 114.254524, 30.548776
9. 江汉路步行街 (3A) - 114.274422, 30.595874
10. 晴川阁 (3A) - 114.272156, 30.552741

### 方案2: 启动后端服务（生产环境）

如果需要连接真实后端API：

#### 步骤1: 启动Spring Boot后端
```bash
cd E:\study\class\m_webgis_project\后端路径
# 启动Spring Boot (端口8082)
mvn spring-boot:run
# 或者
java -jar your-app.jar
```

#### 步骤2: 在微信开发者工具中配置不校验域名
1. 打开微信开发者工具
2. 点击右上角 **详情**
3. 勾选 **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**

#### 步骤3: 验证API可访问
在浏览器中访问：
```
http://localhost:8082/api/tourist-spots
```

应该返回JSON格式的景点数据。

### 方案3: 使用真实域名（正式发布）

微信小程序正式发布时，必须使用HTTPS域名：

1. **部署后端到服务器**，使用HTTPS
2. **修改 `config.js`**:
   ```javascript
   const API_BASE_URL = process.env.NODE_ENV === 'production'
     ? 'https://your-domain.com:8082'  // 替换为真实域名
     : 'http://localhost:8082'
   ```
3. **在微信公众平台配置服务器域名**:
   - 登录 https://mp.weixin.qq.com
   - 开发 > 开发管理 > 开发设置 > 服务器域名
   - 添加你的HTTPS域名

## 当前状态

✅ **模拟数据已启用** - 即使后端未运行，也能正常预览地图和景点功能

⚠️ **腾讯地图Key警告** - 这是正常的，因为：
- 原生地图组件不需要Key
- 搜索和路线规划功能需要Key（已配置）

## 测试功能

现在可以在微信开发者工具中测试：

1. ✅ **地图显示** - 腾讯地图正常显示
2. ✅ **景点标记** - 10个武汉景点标记
3. ✅ **点击景点** - 查看景点详情弹窗
4. ✅ **用户定位** - 获取当前位置
5. ✅ **地图控制** - 缩放、定位、刷新按钮
6. ⚠️ **地点搜索** - 需要腾讯地图Key（已配置，可使用）
7. ⚠️ **路线规划** - 需要腾讯地图Key（已配置，可使用）

## 相关文件

- `myapp/src/services/touristSpotService.js` - 添加了模拟数据降级
- `myapp/src/utils/config.js` - API和腾讯地图配置
- `myapp/src/pages/map/index.vue` - 地图主页面

## 下一步

1. 在微信开发者工具中重新编译（已自动监听文件变化）
2. 查看地图页面，应该能看到10个景点标记
3. 点击标记查看景点详情
4. 测试搜索和路线规划功能（需要腾讯地图Key）

## 疑难解答

### Q: 为什么控制台还有错误信息？
A: 第一次请求会失败（显示错误），然后自动切换到模拟数据。这是正常的降级流程。

### Q: 如何切换回真实API？
A: 启动后端服务后，刷新小程序即可。代码会先尝试API，失败才用模拟数据。

### Q: 模拟数据会影响生产环境吗？
A: 不会。生产环境如果API正常，会使用真实数据。模拟数据只是降级方案。

### Q: 如何禁用模拟数据？
A: 修改 `touristSpotService.js`，在catch块中返回错误而不是模拟数据。
