# 景区图层功能说明

## 功能概述

在 `OlMap.vue` 组件中成功实现了智能景区图层功能，能够根据地图缩放级别动态请求和显示不同等级的景区数据。

## 实现功能

### 1. 智能景区图层创建
- 使用 `createZoomBasedVectorLayer` 创建名为"景区"的图层
- 支持5A到1A共5个等级的景区
- 根据缩放级别自动显示/隐藏不同等级的景区

### 2. 动态数据请求
- **移动地图结束**时自动请求当前视图范围内的景区数据
- **缩放地图结束**时自动请求对应等级的景区数据
- **初始加载**时立即请求一次数据

### 3. 缩放级别与景区等级对应关系

| 缩放级别 | 请求等级 | 显示等级 | 说明 |
|---------|---------|---------|------|
| 0-4.9   | ['5A']  | 5A      | 最低级别只显示最重要的5A景区 |
| 5-6.9   | ['5A', '4A'] | 5A, 4A | 增加显示4A景区 |
| 7-8.9   | ['5A', '4A', '3A'] | 5A, 4A, 3A | 增加显示3A景区 |
| 9-10.9  | ['5A', '4A', '3A', '2A'] | 5A, 4A, 3A, 2A | 增加显示2A景区 |
| 11+     | 所有等级 | 所有等级 | 显示所有等级的景区 |

### 4. 景区样式设计
- **5A景区**: 红色，半径10px，边框3px
- **4A景区**: 绿色，半径8px，边框2.5px  
- **3A景区**: 蓝色，半径6px，边框2px
- **2A景区**: 紫色，半径5px，边框1.5px
- **1A景区**: 橙色，半径4px，边框1px

## 技术实现

### 核心函数

1. **`getLevelsByZoom(zoom)`** - 根据缩放级别确定请求的景区等级
2. **`getSightStyle(feature)`** - 根据景区等级设置样式
3. **`fetchGeoJsonByExtent()`** - 获取当前视图范围内的景区数据
4. **`setupMapListeners()`** - 设置地图事件监听

### 事件监听
- `moveend` - 地图移动结束事件
- `change:resolution` - 缩放级别改变事件

### 性能优化
- 防抖处理避免频繁请求（300ms延迟）
- 只请求当前视图真正需要的数据
- 清除现有要素避免重复显示

## 使用方式

1. 前端开发服务器已启动在 `http://localhost:5173/`
2. 地图初始化时会自动创建景区图层
3. 用户拖拽或缩放地图后会自动更新景区数据
4. 景区数据会添加到名为"景区"的图层中显示

## 后端接口

- **API端点**: `POST /postgis/WGP_db/tables/a_sight/geojson/extent-level`
- **请求参数**: 
  ```json
  {
    "minLon": 经度最小值,
    "minLat": 纬度最小值, 
    "maxLon": 经度最大值,
    "maxLat": 纬度最大值,
    "levels": ["5A", "4A", "3A", "2A", "1A"]
  }
  ```

## 测试验证

✅ 所有功能逻辑测试通过
✅ 前端项目构建成功
✅ 开发服务器正常运行

## 注意事项

1. 确保后端服务在 `http://localhost:8081` 运行
2. 景区等级字段名假设为 'level'，需要根据实际数据调整
3. 缩放级别阈值可根据实际需求调整
