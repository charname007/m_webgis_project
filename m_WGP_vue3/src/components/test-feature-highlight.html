<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>要素高亮功能测试</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
        }
        .controls {
            margin-bottom: 10px;
        }
        button {
            padding: 8px 16px;
            margin-right: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .info {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>要素高亮功能测试</h1>
    
    <div class="controls">
        <button onclick="loadGeoJSON()">加载测试GeoJSON数据</button>
        <button onclick="enableFeatureClick()">启用要素点击</button>
        <button onclick="disableFeatureClick()">禁用要素点击</button>
    </div>
    
    <div id="map"></div>
    
    <div class="info">
        <h3>使用说明：</h3>
        <ol>
            <li>点击"加载测试GeoJSON数据"按钮加载示例数据</li>
            <li>点击"启用要素点击"按钮激活要素点击功能</li>
            <li>点击地图上的要素，要素会高亮并显示属性信息</li>
            <li>点击要素外的区域或关闭弹窗会清除高亮</li>
        </ol>
    </div>

    <script type="module">
        import MapUtils from './mapUtils.js';
        
        let mapUtils;
        
        // 初始化地图
        function initMap() {
            mapUtils = new MapUtils('map');
            mapUtils.addBaseLayer();
            console.log('地图初始化完成');
        }
        
        // 加载测试GeoJSON数据
        function loadGeoJSON() {
            const testGeoJSON = {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "测试点1",
                            "type": "POI",
                            "description": "这是一个测试点要素"
                        },
                        "geometry": {
                            "type": "Point",
                            "coordinates": [116.39722, 39.9096]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "测试线1",
                            "type": "ROAD",
                            "length": "2.5km"
                        },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [116.39722, 39.9096],
                                [116.40722, 39.9096],
                                [116.40722, 39.9196]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "测试面1",
                            "type": "AREA",
                            "area": "1.2km²"
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [116.39722, 39.9096],
                                [116.40722, 39.9096],
                                [116.40722, 39.9196],
                                [116.39722, 39.9196],
                                [116.39722, 39.9096]
                            ]]
                        }
                    }
                ]
            };
            
            const layer = mapUtils.loadGeoJsonLayer(testGeoJSON, {
                fillColor: "rgba(0, 123, 255, 0.3)",
                strokeColor: "#007bff",
                pointColor: "#dc3545",
                strokeWidth: 2,
                pointRadius: 6
            }, "测试图层");
            
            console.log('GeoJSON数据加载完成');
        }
        
        // 启用要素点击功能
        function enableFeatureClick() {
            // 获取所有矢量图层
            const layers = mapUtils.map.getLayers().getArray();
            const vectorLayers = layers.filter(layer => layer instanceof ol.layer.Vector);
            
            if (vectorLayers.length > 0) {
                // 对每个矢量图层启用点击功能
                vectorLayers.forEach(layer => {
                    mapUtils.initFeatureClick();
                });
                console.log('要素点击功能已启用');
                alert('要素点击功能已启用，请点击地图上的要素进行测试');
            } else {
                alert('请先加载GeoJSON数据');
            }
        }
        
        // 禁用要素点击功能
        function disableFeatureClick() {
            mapUtils.removeFeatureClick();
            console.log('要素点击功能已禁用');
        }
        
        // 页面加载完成后初始化地图
        window.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
