<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoJSON图层Extent功能测试</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
        }
        .controls {
            margin-bottom: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .info {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>GeoJSON图层Extent功能测试</h1>
    
    <div class="controls">
        <button onclick="loadGeoJsonWithAutoFit()">加载GeoJSON并自动调整视图</button>
        <button onclick="loadGeoJsonWithoutAutoFit()">加载GeoJSON但不自动调整视图</button>
        <button onclick="zoomToLayerExtent()">手动跳转到图层范围</button>
        <button onclick="getLayerExtentInfo()">获取图层范围信息</button>
        <button onclick="clearLayers()">清除所有图层</button>
    </div>

    <div class="info" id="info">
        点击按钮测试不同的extent功能
    </div>

    <div id="map"></div>

    <!-- 引入OpenLayers -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@8.2.0/ol.css">
    <script src="https://cdn.jsdelivr.net/npm/ol@8.2.0/dist/ol.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ol-ext@4.0.12/dist/ol-ext.min.css"></script>
    <script src="https://cdn.jsdelivr.net/npm/ol-ext@4.0.12/dist/ol-ext.min.js"></script>

    <script>
        // 示例GeoJSON数据（一个简单的多边形）
        const sampleGeoJson = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "name": "测试区域1",
                        "type": "多边形"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [116.3, 39.8],
                            [116.5, 39.8],
                            [116.5, 40.0],
                            [116.3, 40.0],
                            [116.3, 39.8]
                        ]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "测试区域2",
                        "type": "点"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [116.4, 39.9]
                    }
                }
            ]
        };

        let mapUtils;
        let currentLayer = null;

        // 初始化地图
        function initMap() {
            mapUtils = new MapUtils('map');
            mapUtils.addBaseLayer();
            
            document.getElementById('info').innerHTML = '地图初始化完成，可以开始测试extent功能';
        }

        // 加载GeoJSON并自动调整视图
        function loadGeoJsonWithAutoFit() {
            if (currentLayer) {
                mapUtils.map.removeLayer(currentLayer);
            }
            
            currentLayer = mapUtils.loadGeoJsonLayer(sampleGeoJson, {}, '测试图层', {
                autoFitExtent: true,
                fitPadding: 50,
                storeExtent: true
            });
            
            document.getElementById('info').innerHTML = 'GeoJSON图层已加载，视图已自动调整到图层范围';
        }

        // 加载GeoJSON但不自动调整视图
        function loadGeoJsonWithoutAutoFit() {
            if (currentLayer) {
                mapUtils.map.removeLayer(currentLayer);
            }
            
            currentLayer = mapUtils.loadGeoJsonLayer(sampleGeoJson, {}, '测试图层', {
                autoFitExtent: false,
                storeExtent: true
            });
            
            document.getElementById('info').innerHTML = 'GeoJSON图层已加载，视图未自动调整';
        }

        // 手动跳转到图层范围
        function zoomToLayerExtent() {
            if (!currentLayer) {
                document.getElementById('info').innerHTML = '请先加载GeoJSON图层';
                return;
            }
            
            const success = mapUtils.zoomToLayerExtent(currentLayer, 30);
            if (success) {
                document.getElementById('info').innerHTML = '已跳转到图层范围';
            } else {
                document.getElementById('info').innerHTML = '跳转到图层范围失败';
            }
        }

        // 获取图层范围信息
        function getLayerExtentInfo() {
            if (!currentLayer) {
                document.getElementById('info').innerHTML = '请先加载GeoJSON图层';
                return;
            }
            
            const extent = mapUtils.getLayerExtent(currentLayer);
            const storedExtent = mapUtils.getStoredLayerExtent(currentLayer);
            const center = mapUtils.getLayerCenter(currentLayer);
            
            let info = '图层范围信息：<br>';
            info += `实时计算的范围: ${extent ? extent.join(', ') : '无'}<br>`;
            info += `存储的范围: ${storedExtent ? storedExtent.join(', ') : '无'}<br>`;
            info += `中心点: ${center ? center.join(', ') : '无'}`;
            
            document.getElementById('info').innerHTML = info;
        }

        // 清除所有图层
        function clearLayers() {
            if (currentLayer) {
                mapUtils.map.removeLayer(currentLayer);
                currentLayer = null;
            }
            document.getElementById('info').innerHTML = '所有图层已清除';
        }

        // 页面加载完成后初始化地图
        window.onload = initMap;
    </script>

    <!-- 引入mapUtils.js -->
    <script src="mapUtils.js"></script>
</body>
</html>
