{"timestamp": "2025-10-04T20:41:31.683112", "query_id": "session_12ab20e1_1759581639", "event": "sql_execution", "step": 0, "sql": "SELECT COUNT(*) as count\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (ts.name LIKE a.name || '%' OR TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name)\nWHERE a.\"所属城市\" = '武汉' OR ts.\"城市\" = '武汉'\n", "status": "success", "duration_ms": 30008.15224647522, "rows_returned": 0, "error": null}
{"timestamp": "2025-10-04T20:46:53.326624", "query_id": "session_3bf144fd_1759581870", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'address', COALESCE(ts.\"地址\", a.address),\n    'city', COALESCE(ts.\"城市\", a.\"所属城市\"),\n    'province', a.\"所属省份\",\n    'district', a.\"所属区县\",\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^[0-9.]+$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'open_time', ts.\"开放时间\",\n    'suggested_duration', ts.\"建议游玩时间\",\n    'suggested_season', ts.\"建议季节\",\n    'tips', ts.\"小贴士\",\n    'image_url', ts.\"图片链接\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN ARRAY[a.lng_wgs84, a.lat_wgs84] \n        ELSE NULL \n    END\n)) as result\nFROM (\n    -- 从 a_sight a 表获取武汉的景点\n    SELECT a.* FROM a_sight a \n    WHERE a.\"所属城市\" = '武汉' OR a.\"所属城市\" LIKE '%武汉%'\n    \n    UNION ALL\n    \n    -- 从 tourist_spot 表获取武汉的景点\n    SELECT DISTINCT ON (ts.name) \n        NULL as gid, ts.name, NULL as level, \n        ts.\"城市\" as \"所属省份\", ts.\"地址\" as address,\n        NULL as \"评定时间\", NULL as \"发布时间\", NULL as \"发布链接\",\n        NULL as lng_gcj02, NULL as lat_gcj02, NULL as lng_bd09, NULL as lat_bd09,\n        NULL as lng_wgs84, NULL as lat_wgs84,\n        ts.\"城市\" as \"所属城市\", NULL as \"所属区县\", NULL as geom\n    FROM tourist_spot ts\n    WHERE ts.\"城市\" = '武汉' OR ts.\"城市\" LIKE '%武汉%'\n      AND NOT EXISTS (\n          SELECT 1 FROM a_sight a2 \n          WHERE (a2.\"所属城市\" = '武汉' OR a2.\"所属城市\" LIKE '%武汉%')\n            AND (ts.name LIKE a2.name || '%' OR TRIM(SPLIT_PART(ts.name, ' ', 1)) = a2.name)\n      )\n) a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' OR \n    TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name OR\n    a.name = TRIM(SPLIT_PART(ts.name, ' ', 1))\n)\nWHERE (ts.\"城市\" = '武汉' OR ts.\"城市\" LIKE '%武汉%' OR a.\"所属城市\" = '武汉' OR a.\"所属城市\" LIKE '%武汉%')", "status": "success", "duration_ms": 10781.980276107788, "rows_returned": 157, "error": null}
{"timestamp": "2025-10-04T20:48:28.929842", "query_id": "session_6edabcf1_1759582030", "event": "sql_execution", "step": 0, "sql": "SELECT COUNT(*) as count\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (ts.name LIKE a.name || '%' OR TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name)\nWHERE a.\"所属城市\" = '武汉市' AND a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL\n", "status": "success", "duration_ms": 1041.9511795043945, "rows_returned": 1, "error": null}
{"timestamp": "2025-10-04T20:57:40.366373", "query_id": "session_ea0f3137_1759582608", "event": "sql_execution", "step": 0, "sql": "SELECT COUNT(*) as count\nFROM a_sight a\nLEFT JOIN tourist_spot t ON (t.name LIKE a.name || '%' OR TRIM(SPLIT_PART(t.name, ' ', 1)) = a.name)\nWHERE a.所属城市 = '武汉市' OR t.城市 = '武汉市'\n", "status": "success", "duration_ms": 30010.15043258667, "rows_returned": 0, "error": null}
{"timestamp": "2025-10-04T21:14:38.051498", "query_id": "session_75b44c39_1759583661", "event": "sql_execution", "step": 0, "sql": "SELECT\n  COALESCE(a.\"所属区县\", '未知') as district,\n  COUNT(*) as count,\n  AVG(a.lng_wgs84) as center_lng,\n  AVG(a.lat_wgs84) as center_lat,\n  MIN(a.lng_wgs84) as min_lng,\n  MAX(a.lng_wgs84) as max_lng,\n  MIN(a.lat_wgs84) as min_lat,\n  MAX(a.lat_wgs84) as max_lat\nFROM a_sight a\nWHERE a.\"所属城市\" = '武汉市'\n  AND a.lng_wgs84 IS NOT NULL\n  AND a.lat_wgs84 IS NOT NULL\nGROUP BY a.\"所属区县\"\nORDER BY count DESC", "status": "success", "duration_ms": 112.99467086791992, "rows_returned": 11, "error": null}
{"timestamp": "2025-10-04T21:15:46.917034", "query_id": "session_5c0510a9_1759583731", "event": "sql_execution", "step": 0, "sql": "SELECT \n    COALESCE(a.\"所属区县\", '未知') as district,\n    COUNT(*) as count,\n    AVG(a.lng_wgs84) as center_lng,\n    AVG(a.lat_wgs84) as center_lat,\n    MIN(a.lng_wgs84) as bbox_min_lng,\n    MAX(a.lng_wgs84) as bbox_max_lng,\n    MIN(a.lat_wgs84) as bbox_min_lat,\n    MAX(a.lat_wgs84) as bbox_max_lat\nFROM a_sight a\nWHERE a.\"所属城市\" = '武汉市' \n    AND a.lng_wgs84 IS NOT NULL \n    AND a.lat_wgs84 IS NOT NULL\nGROUP BY a.\"所属区县\"\nORDER BY count DESC", "status": "success", "duration_ms": 10.58650016784668, "rows_returned": 11, "error": null}
{"timestamp": "2025-10-04T21:35:28.441898", "query_id": "session_b23a5788_1759584914", "event": "sql_execution", "step": 0, "sql": "SELECT\n  COALESCE(a.\"所属区县\", '未知') as district,\n  COUNT(*) as count,\n  AVG(a.lng_wgs84) as center_lng,\n  AVG(a.lat_wgs84) as center_lat\nFROM a_sight a\nWHERE a.\"所属城市\" = '武汉市'\n  AND a.lng_wgs84 IS NOT NULL\n  AND a.lat_wgs84 IS NOT NULL\nGROUP BY a.\"所属区县\"\nORDER BY count DESC", "status": "success", "duration_ms": 62.09707260131836, "rows_returned": 11, "error": null}
{"timestamp": "2025-10-04T21:40:38.021371", "query_id": "session_f8879fb6_1759585223", "event": "sql_execution", "step": 0, "sql": "SELECT \n    COALESCE(a.\"所属区县\", '未知') as district,\n    COUNT(*) as count,\n    AVG(a.lng_wgs84) as center_lng,\n    AVG(a.lat_wgs84) as center_lat\nFROM a_sight a\nWHERE a.\"所属城市\" = '武汉市'\n    AND a.lng_wgs84 IS NOT NULL\n    AND a.lat_wgs84 IS NOT NULL\nGROUP BY a.\"所属区县\"\nORDER BY count DESC", "status": "success", "duration_ms": 26.065826416015625, "rows_returned": 11, "error": null}
{"timestamp": "2025-10-04T22:07:52.936787", "query_id": "session_421fb023_1759586855", "event": "sql_execution", "step": 0, "sql": "SELECT \n    COALESCE(a.\"所属区县\", '未知') as district,\n    COUNT(*) as count,\n    AVG(a.lng_wgs84) as center_lng,\n    AVG(a.lat_wgs84) as center_lat,\n    MIN(a.lng_wgs84) as bbox_min_lng,\n    MAX(a.lng_wgs84) as bbox_max_lng,\n    MIN(a.lat_wgs84) as bbox_min_lat,\n    MAX(a.lat_wgs84) as bbox_max_lat\nFROM a_sight a\nWHERE a.\"所属城市\" = '武汉市' \n    AND a.lng_wgs84 IS NOT NULL \n    AND a.lat_wgs84 IS NOT NULL\nGROUP BY a.\"所属区县\"\nORDER BY count DESC;", "status": "success", "duration_ms": 34.84058380126953, "rows_returned": 11, "error": null}
{"timestamp": "2025-10-04T22:16:15.958384", "query_id": "session_97b93e46_1759587361", "event": "sql_execution", "step": 0, "sql": "SELECT \n    COALESCE(a.\"所属区县\", '未知') as district,\n    COUNT(*) as count,\n    AVG(a.lng_wgs84) as center_lng,\n    AVG(a.lat_wgs84) as center_lat\nFROM a_sight a\nWHERE a.\"所属城市\" = '武汉市'\n    AND a.lng_wgs84 IS NOT NULL\n    AND a.lat_wgs84 IS NOT NULL\nGROUP BY a.\"所属区县\"\nORDER BY count DESC", "status": "success", "duration_ms": 78.44328880310059, "rows_returned": 11, "error": null}
{"timestamp": "2025-10-04T23:44:19.874563", "query_id": "session_f51be74e_1759592639", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\", \n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\",\n    'address', COALESCE(ts.\"地址\", a.address),\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^[0-9.]+$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'open_time', ts.\"开放时间\",\n    'suggested_duration', ts.\"建议游玩时间\",\n    'suggested_season', ts.\"建议季节\",\n    'tips', ts.\"小贴士\",\n    'image_url', ts.\"图片链接\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL \n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' \n    OR TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name\n)\nWHERE a.\"所属城市\" = '杭州' AND a.level = '5A'", "status": "success", "duration_ms": 72.10516929626465, "rows_returned": 0, "error": null}
{"timestamp": "2025-10-04T23:46:07.646752", "query_id": "session_b5ea15ae_1759592745", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\",\n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\",\n    'address', COALESCE(ts.\"地址\", a.address),\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^[0-9.]+$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'open_time', ts.\"开放时间\",\n    'suggested_duration', ts.\"建议游玩时间\",\n    'suggested_season', ts.\"建议季节\",\n    'tips', ts.\"小贴士\",\n    'image_url', ts.\"图片链接\",\n    'link', ts.\"链接\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL \n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' OR \n    TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name OR\n    ts.\"地址\" LIKE '%' || a.name || '%'\n)\nWHERE a.\"所属城市\" = '武汉市' AND a.level = '5A'\nAND a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL;", "status": "success", "duration_ms": 1133.0549716949463, "rows_returned": 7, "error": null}
{"timestamp": "2025-10-04T23:51:11.627433", "query_id": "session_4baf0876_1759593050", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\",\n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\",\n    'address', COALESCE(ts.\"地址\", a.address),\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^[0-9.]+$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'open_time', ts.\"开放时间\",\n    'suggested_duration', ts.\"建议游玩时间\",\n    'suggested_season', ts.\"建议季节\",\n    'tips', ts.\"小贴士\",\n    'image_url', ts.\"图片链接\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL \n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (ts.name LIKE a.name || '%' OR TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name)\nWHERE a.\"所属省份\" = '北京' AND a.level = '5A'", "status": "success", "duration_ms": 819.4839954376221, "rows_returned": 9, "error": null}
{"timestamp": "2025-10-05T00:18:17.493288", "query_id": "session_4344652d_1759594674", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\",\n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\", \n    'address', COALESCE(ts.\"地址\", a.address),\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^\\d+(\\.\\d+)?$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'opening_hours', ts.\"开放时间\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL\n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' OR \n    TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name\n)\nWHERE a.level = '5A' AND a.\"所属省份\" = '北京';", "status": "success", "duration_ms": 1631.5038204193115, "rows_returned": 9, "error": null}
{"timestamp": "2025-10-05T00:28:06.255100", "query_id": "session_01d48911_1759595257", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\",\n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\",\n    'address', COALESCE(ts.\"地址\", a.address),\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^\\d+(\\.\\d+)?$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'opening_hours', ts.\"开放时间\",\n    'suggested_duration', ts.\"建议游玩时间\",\n    'best_season', ts.\"建议季节\",\n    'tips', ts.\"小贴士\",\n    'image_url', ts.\"图片链接\",\n    'page_url', ts.\"链接\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL \n    END,\n    'data_source', CASE \n        WHEN ts.id IS NOT NULL AND a.gid IS NOT NULL THEN 'both'\n        WHEN ts.id IS NOT NULL THEN 'tourist_spot_only' \n        ELSE 'a_sight_only'\n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' \n    OR TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name\n)\nWHERE a.level = '5A' AND a.\"所属省份\" = '北京'", "status": "success", "duration_ms": 4199.771165847778, "rows_returned": 9, "error": null}
{"timestamp": "2025-10-05T00:30:01.290851", "query_id": "session_a6d05701_1759595380", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\",\n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\",\n    'address', COALESCE(ts.\"地址\", a.address),\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL\n    END,\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^\\d+(\\.\\d+)?$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'opening_hours', ts.\"开放时间\",\n    'suggested_duration', ts.\"建议游玩时间\",\n    'best_season', ts.\"建议季节\",\n    'tips', ts.\"小贴士\",\n    'image_url', ts.\"图片链接\",\n    'source_link', ts.\"链接\"\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' OR \n    TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name\n)\nWHERE a.level = '5A' AND a.\"所属省份\" = '北京'", "status": "success", "duration_ms": 555.2449226379395, "rows_returned": 9, "error": null}
{"timestamp": "2025-10-05T00:55:37.450927", "query_id": "session_ffa4744d_1759596895", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(t.name, a.name),\n    'level', a.level,\n    'city', a.所属城市,\n    'province', a.所属省份,\n    'address', COALESCE(t.地址, a.address),\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL\n    END,\n    'rating', CASE \n        WHEN t.评分 ~ '^[0-9.]+$' THEN t.评分::numeric \n        ELSE NULL \n    END,\n    'ticket_price', t.门票,\n    'introduction', t.介绍,\n    'open_time', t.开放时间,\n    'suggested_duration', t.建议游玩时间,\n    'suggested_season', t.建议季节,\n    'tips', t.小贴士,\n    'image_url', t.图片链接,\n    'source_link', t.链接\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot t ON (\n    t.name LIKE a.name || '%' OR \n    TRIM(SPLIT_PART(t.name, ' ', 1)) = a.name\n)\nWHERE a.level = '5A' AND a.所属城市 = '杭州'\n  AND a.name IS NOT NULL;", "status": "success", "duration_ms": 135.81347465515137, "rows_returned": 0, "error": null}
{"timestamp": "2025-10-05T00:56:23.479816", "query_id": "session_a3a02df7_1759596959", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\",\n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\",\n    'address', COALESCE(ts.\"地址\", a.address),\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^\\d+(\\.\\d+)?$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'opening_hours', ts.\"开放时间\",\n    'suggested_duration', ts.\"建议游玩时间\",\n    'best_season', ts.\"建议季节\",\n    'tips', ts.\"小贴士\",\n    'image_url', ts.\"图片链接\",\n    'link', ts.\"链接\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL \n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' \n    OR TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name\n)\nWHERE a.level = '5A' \nAND (a.\"所属省份\" = '北京' OR a.\"所属城市\" = '北京');", "status": "success", "duration_ms": 1717.3311710357666, "rows_returned": 9, "error": null}
{"timestamp": "2025-10-05T01:03:04.435156", "query_id": "session_454f761f_1759597331", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(t.name, a.name),\n    'level', a.level,\n    'city', COALESCE(t.城市, a.所属城市),\n    'province', a.所属省份,\n    'address', COALESCE(t.地址, a.address),\n    'rating', CASE \n        WHEN t.评分 ~ '^[0-9.]+$' THEN t.评分::numeric \n        ELSE NULL \n    END,\n    'ticket_price', t.门票,\n    'introduction', t.介绍,\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL \n    END,\n    'data_source', CASE \n        WHEN t.id IS NOT NULL AND a.gid IS NOT NULL THEN 'both'\n        WHEN t.id IS NOT NULL THEN 'tourist_spot'\n        ELSE 'a_sight'\n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot t ON (t.name LIKE a.name || '%' OR TRIM(SPLIT_PART(t.name, ' ', 1)) = a.name)\nWHERE (a.所属城市 = '武汉市' OR t.城市 = '武汉市')\n  AND a.level = '5A'", "status": "success", "duration_ms": 10312.461376190186, "rows_returned": 7, "error": null}
{"timestamp": "2025-10-05T01:14:51.570208", "query_id": "session_0579f17f_1759598068", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\",\n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\",\n    'address', COALESCE(ts.\"地址\", a.address),\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^\\d+(\\.\\d+)?$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'opening_hours', ts.\"开放时间\",\n    'suggested_duration', ts.\"建议游玩时间\",\n    'best_season', ts.\"建议季节\",\n    'tips', ts.\"小贴士\",\n    'image_url', ts.\"图片链接\",\n    'link', ts.\"链接\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL \n    END,\n    'data_source', CASE \n        WHEN ts.id IS NOT NULL AND a.gid IS NOT NULL THEN 'both'\n        WHEN ts.id IS NOT NULL THEN 'tourist_spot_only' \n        ELSE 'a_sight_only'\n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' OR \n    TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name\n)\nWHERE a.\"所属省份\" = '浙江省' AND a.level = '5A';", "status": "success", "duration_ms": 264.6031379699707, "rows_returned": 0, "error": null}
{"timestamp": "2025-10-05T01:34:26.354216", "query_id": "session_21125e4f_1759599250", "event": "sql_execution", "step": 0, "sql": "SELECT \n    COALESCE(a.\"所属区县\", '未知') as district,\n    COUNT(*) as count,\n    AVG(a.lng_wgs84) as center_lng,\n    AVG(a.lat_wgs84) as center_lat\nFROM a_sight a\nWHERE a.\"所属城市\" = '武汉市' \n    AND a.lng_wgs84 IS NOT NULL \n    AND a.lat_wgs84 IS NOT NULL\nGROUP BY a.\"所属区县\"\nORDER BY count DESC", "status": "success", "duration_ms": 118.9279556274414, "rows_returned": 11, "error": null}
{"timestamp": "2025-10-05T14:48:32.229065", "query_id": "session_c024464e_1759646884", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', name,\n    'level', level,\n    'province', \"所属省份\",\n    'city', \"所属城市\",\n    'district', \"所属区县\",\n    'address', address,\n    'coordinates', CASE WHEN lng_wgs84 IS NOT NULL AND lat_wgs84 IS NOT NULL \n                       THEN json_build_array(lng_wgs84, lat_wgs84) \n                       ELSE NULL END\n)) as result\nFROM a_sight\nWHERE lng_wgs84 IS NOT NULL AND lat_wgs84 IS NOT NULL\nLIMIT 50;", "status": "success", "duration_ms": 137.23087310791016, "rows_returned": 14847, "error": null}
{"timestamp": "2025-10-05T14:51:01.640578", "query_id": "session_595d4706_1759647040", "event": "sql_execution", "step": 0, "sql": "SELECT json_agg(json_build_object(\n    'name', COALESCE(ts.name, a.name),\n    'level', a.level,\n    'province', a.\"所属省份\",\n    'city', a.\"所属城市\",\n    'district', a.\"所属区县\",\n    'address', COALESCE(ts.\"地址\", a.address),\n    'rating', CASE \n        WHEN ts.\"评分\" ~ '^\\d+(\\.\\d+)?$' THEN ts.\"评分\"::numeric \n        ELSE NULL \n    END,\n    'ticket_price', ts.\"门票\",\n    'introduction', ts.\"介绍\",\n    'opening_hours', ts.\"开放时间\",\n    'coordinates', CASE \n        WHEN a.lng_wgs84 IS NOT NULL AND a.lat_wgs84 IS NOT NULL \n        THEN json_build_array(a.lng_wgs84, a.lat_wgs84)\n        ELSE NULL \n    END\n)) as result\nFROM a_sight a\nLEFT JOIN tourist_spot ts ON (\n    ts.name LIKE a.name || '%' \n    OR TRIM(SPLIT_PART(ts.name, ' ', 1)) = a.name\n    OR ts.\"城市\" = a.\"所属城市\"\n)\nWHERE a.\"所属城市\" = '武汉市' \n  AND a.level = '5A'\n  AND (a.lng_wgs84 IS NOT NULL OR ts.id IS NOT NULL);", "status": "success", "duration_ms": 506.3016414642334, "rows_returned": 7, "error": null}
