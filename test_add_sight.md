# 添加景区功能测试指南

## 问题分析
前端发送的原始数据结构与后端期望的双表结构不匹配，导致400错误。

## 修复内容

### 1. 前端数据结构修正
**修复前**（错误的扁平结构）:
```json
{
  "name": "景点名称",
  "address": "详细地址",
  "lng_wgs84": 116.397428,
  "lat_wgs84": 39.918852,
  "level": "5A",
  "image_url": "图片链接",
  "city": "城市",
  // ... 其他字段
}
```

**修复后**（正确的双表结构）:
```json
{
  "tourist_spot": {
    "name": "景点名称",
    "链接": "",
    "地址": "详细地址",
    "介绍": "景点介绍",
    "开放时间": "08:30-17:00",
    "图片链接": "图片链接",
    "评分": "4.8",
    "建议游玩时间": "3-4小时",
    "建议季节": "春秋两季",
    "门票": "60元",
    "小贴士": "建议提前预约门票",
    "城市": "城市"
  },
  "a_sight": {
    "name": "景点名称",
    "level": "5A",
    "address": "详细地址",
    "所属城市": "城市",
    "lngWgs84": 116.397428,
    "latWgs84": 39.918852
  }
}
```

### 2. 后端错误处理增强
- 添加了详细的参数验证
- 增加了调试日志输出
- 改进了异常处理机制

### 3. 字段映射说明
**TouristSpot表字段**:
- `name` → 景点名称（必填）
- `地址` → 详细地址
- `图片链接` → 图片链接
- `城市` → 城市
- `介绍` → 景点介绍
- `开放时间` → 开放时间
- `评分` → 评分
- `门票` → 门票价格
- `建议游玩时间` → 建议游玩时间
- `建议季节` → 建议季节
- `小贴士` → 小贴士

**ASight表字段**:
- `name` → 景区名称
- `level` → 景区等级
- `address` → 详细地址
- `所属城市` → 城市
- `lngWgs84` → 经度(WGS84)
- `latWgs84` → 纬度(WGS84)

## 测试步骤

### 1. 启动后端服务
```bash
cd be
./mvnw spring-boot:run
```

### 2. 启动前端服务
```bash
cd m_WGP_vue3
npm run dev
```

### 3. 测试添加功能
1. 打开前端页面
2. 点击"添加新景区"按钮
3. 填写以下测试数据：
   - 景点名称: `故宫博物院`
   - 景区等级: `5A`
   - 图片链接: `https://example.com/forbidden-city.jpg`
   - 城市: `北京`
   - 详细地址: `北京市东城区景山前街4号`
   - 经度: `116.397428`
   - 纬度: `39.918852`
   - 评分: `4.8`
   - 门票价格: `60元`
   - 开放时间: `08:30-17:00`
   - 建议游玩时间: `3-4小时`
   - 建议季节: `春秋两季`
   - 小贴士: `建议提前预约门票`
   - 景点介绍: `故宫博物院是中国明清两代的皇家宫殿，旧称紫禁城`

4. 点击保存按钮

### 4. 验证结果
- 成功: 应该看到成功提示，新数据添加到数据库
- 失败: 查看浏览器控制台和后端日志中的详细错误信息

## API端点
- **URL**: `POST http://localhost:8082/api/tourist-spots/with-sight`
- **Content-Type**: `application/json`
- **请求体**: 如上所示的双表结构

## 常见问题

### 1. 景点名称为空
**错误**: "景点名称为空"
**解决**: 确保景点名称字段不为空

### 2. 坐标格式错误
**错误**: 坐标转换异常
**解决**: 确保经纬度为有效的数字格式

### 3. 字段类型不匹配
**错误**: 类型转换异常
**解决**: 检查所有字段的数据类型是否正确

## 调试信息
后端会输出详细的调试日志，包括：
- 接收到的请求体
- 中文名称处理过程
- 数据库操作结果
- 任何异常信息

通过查看这些日志，可以快速定位问题所在。